<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Search Apartments</title>
    <link rel="stylesheet" href="static/style.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"
        integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" rel="stylesheet">

</head>

<body>
    <header class="navbar">
        <div class="navbar-brand">
            <a href="/" class="navbar-item">Home</a>
        </div>
        <nav class="navbar-menu">

            <a href="/" class="navbar-item">Search Apartments</a>
            <a href="/" class="navbar-item">Set Preferences</a>
            <a href="/" class="navbar-item">Contact Us</a>
            <a href="/" class="navbar-item">About</a>
        </nav>
    </header>

    <div class="container">
        <h1>Search Nearby Apartments</h1>
        <form id="location-form" method="POST">
            <!-- Input Method Selection -->
            <label for="input-method">Choose Input Method:</label>
            <select id="input-method" name="input-method" required onchange="toggleInputFields()">
                <option value="">Select Input Method</option>
                <option value="lat-lng">Enter Latitude and Longitude</option>
                <option value="city-college">Enter City and College</option>
            </select>

            <!-- Latitude and Longitude Inputs -->
            <div id="lat-lng-fields" style="display:none;">
                <label for="latitude" style="display: block;">Latitude:</label>
                <input type="text" id="latitude" name="latitude" placeholder="Enter latitude"
                    oninput="updateMapFromLatLng()">

                <label for="longitude" style="display: block;">Longitude:</label>
                <input type="text" id="longitude" name="longitude" placeholder="Enter longitude"
                    oninput="updateMapFromLatLng()">
            </div>

            <!-- City and College Inputs -->
            <div id="city-college-fields" style="display: none;">
                <label for="city" style="display: block;">City:</label>
                <select id="city" name="city" onchange="populateColleges()">
                    <option value="">Select City</option>
                    <option value="delhi">Delhi</option>
                    <option value="mumbai">Mumbai</option>
                    <option value="chennai">Chennai</option>
                    <option value="bangalore">Bangalore</option>
                    <option value="hyderabad">Hyderabad</option>
                    <option value="pune">Pune</option>
                    <option value="kolkata">Kolkata</option>
                </select>

                <label for="college" style="display: block;">College:</label>
                <select id="college" name="college" onchange="updateMap()">
                    <option value="">Select College</option>
                </select>
            </div>

            <!-- Preferences -->
            <label for="preference1">Preference 1:</label>
            <select id="preference1" name="preference1" required>
                <option value="">Select Preference</option>
                <option value="Restaurants">Restaurants</option>
                <option value="Groceries">Groceries</option>
                <option value="Gyms">Gyms</option>
                <option value="Cafes">Cafes</option>
                <option value="Parks">Parks</option>
                <option value="Hospitals">Hospitals</option>
                <option value="Shopping Malls">Shopping Malls</option>
                <option value="Banks/ATMs">Banks/ATMs</option>
                <option value="Libraries">Libraries</option>
                <option value="Pharmacies">Pharmacies</option>
                <option value="Fitness Studios">Fitness Studios</option>
            </select>

            <label for="preference2">Preference 2:</label>
            <select id="preference2" name="preference2" required>
                <option value="">Select Preference</option>
                <option value="Restaurants">Restaurants</option>
                <option value="Groceries">Groceries</option>
                <option value="Gyms">Gyms</option>
                <option value="Cafes">Cafes</option>
                <option value="Parks">Parks</option>
                <option value="Hospitals">Hospitals</option>
                <option value="Shopping Malls">Shopping Malls</option>
                <option value="Banks/ATMs">Banks/ATMs</option>
                <option value="Libraries">Libraries</option>
                <option value="Pharmacies">Pharmacies</option>
                <option value="Fitness Studios">Fitness Studios</option>
            </select>

            <!-- Display Metro Station -->


            <label for="display-metro">Display Metro Station:</label>
            <div class="button-group">
                <button type="button" id="metro-yes" class="metro-button" data-value="yes">Yes</button>
                <button type="button" id="metro-no" class="metro-button" data-value="no">No</button>

            </div>
            <!-- Hidden input field to store the value -->
            <input type="hidden" id="display-metro" name="display_metro" value="">






            <button type="submit">Search</button>
        </form>


        <div id="map-container">
            <iframe id="map" src="" title="Accommodation Map"
                style="width: 100%; height: 400px; border: none;"></iframe>
        </div>
    </div>

    <footer class="bg-dark text-white mt-5">
        <div class="container py-2 bg-dark">


            <div class="text-center">
                <small>&copy; 2024 My Project. All rights reserved.</small>
            </div>
        </div>
    </footer>




    <script>
        // Hardcoded data for cities, colleges, and their lat/lng
        const cityColleges = {
            bangalore: [
                { name: "IISc", lat: 13.021, lng: 77.566 },
                { name: "RVCE", lat: 12.923, lng: 77.500 },
                { name: "BMSCE", lat: 12.941, lng: 77.565 },
                { name: "PESU", lat: 12.933, lng: 77.534 },
                { name: "MSRIT", lat: 13.031, lng: 77.566 },
                { name: "Christ University", lat: 12.937, lng: 77.621 },
                { name: "NITTE Meenakshi", lat: 13.130, lng: 77.586 },
                { name: "Jain University", lat: 12.834, lng: 77.684 },
                { name: "Reva University", lat: 13.108, lng: 77.637 },
                { name: "New Horizon College", lat: 12.960, lng: 77.697 }
            ],
            delhi: [
                { name: "IIT Delhi", lat: 28.545, lng: 77.192 },
                { name: "DTU", lat: 28.750, lng: 77.117 },
                { name: "NSUT", lat: 28.609, lng: 77.033 },
                { name: "IIIT Delhi", lat: 28.544, lng: 77.272 },
                { name: "JMI", lat: 28.561, lng: 77.280 },
                { name: "IGDTUW", lat: 28.665, lng: 77.232 },
                { name: "GGSIPU", lat: 28.751, lng: 77.117 },
                { name: "MAIT", lat: 28.716, lng: 77.113 },
                { name: "BVP", lat: 28.631, lng: 77.208 },
                { name: "Sharda University", lat: 28.475, lng: 77.493 }
            ],
            mumbai: [
                { name: "IIT Bombay", lat: 19.133, lng: 72.915 },
                { name: "VJTI", lat: 19.022, lng: 72.855 },
                { name: "SPIT", lat: 19.106, lng: 72.836 },
                { name: "NMIMS", lat: 19.107, lng: 72.836 },
                { name: "KJ Somaiya", lat: 19.072, lng: 72.899 },
                { name: "ICT Mumbai", lat: 19.025, lng: 72.857 },
                { name: "Thakur College", lat: 19.221, lng: 72.862 },
                { name: "Atharva College", lat: 19.208, lng: 72.835 },
                { name: "DJ Sanghvi", lat: 19.111, lng: 72.841 },
                { name: "Rizvi College", lat: 19.067, lng: 72.830 }
            ],
            chennai: [
                { name: "IIT Madras", lat: 12.991, lng: 80.233 },
                { name: "Anna University", lat: 13.011, lng: 80.236 },
                { name: "SSN College", lat: 12.845, lng: 80.152 },
                { name: "SRM University", lat: 12.823, lng: 80.045 },
                { name: "VIT Chennai", lat: 12.841, lng: 80.153 },
                { name: "Hindustan University", lat: 12.842, lng: 80.145 },
                { name: "Sathyabama University", lat: 12.872, lng: 80.228 },
                { name: "St. Joseph's", lat: 12.850, lng: 80.223 },
                { name: "Saveetha Engineering College", lat: 13.033, lng: 80.066 },
                { name: "Velammal Engineering College", lat: 13.120, lng: 80.214 }
            ],
            hyderabad: [
                { name: "IIT Hyderabad", lat: 17.544, lng: 78.572 },
                { name: "IIIT Hyderabad", lat: 17.445, lng: 78.348 },
                { name: "JNTU Hyderabad", lat: 17.494, lng: 78.391 },
                { name: "OUCE", lat: 17.421, lng: 78.523 },
                { name: "GITAM Hyderabad", lat: 17.421, lng: 78.682 },
                { name: "CBIT", lat: 17.394, lng: 78.315 },
                { name: "Vardhaman College", lat: 17.265, lng: 78.410 },
                { name: "MGIT", lat: 17.384, lng: 78.393 },
                { name: "CMRIT", lat: 17.493, lng: 78.572 },
                { name: "Anurag University", lat: 17.417, lng: 78.524 }
            ],
            kolkata: [
                { name: "IIT Kharagpur", lat: 22.314, lng: 87.310 },
                { name: "Jadavpur University", lat: 22.499, lng: 88.371 },
                { name: "IEM Kolkata", lat: 22.575, lng: 88.430 },
                { name: "Techno India", lat: 22.579, lng: 88.431 },
                { name: "Heritage Institute", lat: 22.461, lng: 88.396 },
                { name: "Amity Kolkata", lat: 22.669, lng: 88.439 },
                { name: "UEM Kolkata", lat: 22.576, lng: 88.431 },
                { name: "GNIT", lat: 22.693, lng: 88.472 },
                { name: "BP Poddar", lat: 22.548, lng: 88.391 },
                { name: "Adamas University", lat: 22.826, lng: 88.446 }
            ],
            pune: [
                { name: "COEP", lat: 18.529, lng: 73.849 },
                { name: "VIT Pune", lat: 18.457, lng: 73.867 },
                { name: "PCCOE", lat: 18.650, lng: 73.759 },
                { name: "MIT Pune", lat: 18.523, lng: 73.818 },
                { name: "Bharati Vidyapeeth", lat: 18.464, lng: 73.857 },
                { name: "DY Patil", lat: 18.631, lng: 73.807 },
                { name: "Sinhgad College", lat: 18.455, lng: 73.810 },
                { name: "PICT", lat: 18.463, lng: 73.867 },
                { name: "FLAME University", lat: 18.535, lng: 73.827 },
                { name: "Symbiosis", lat: 18.592, lng: 73.772 }
            ]
        };


        function populateColleges() {
            const city = document.getElementById("city").value;
            const collegeDropdown = document.getElementById("college");
            collegeDropdown.innerHTML = '<option value="">Select College</option>'; // Clear previous options

            if (city && cityColleges[city]) {
                cityColleges[city].forEach(college => {
                    const option = document.createElement("option");
                    option.value = `${college.lat},${college.lng}`;
                    option.textContent = college.name;
                    collegeDropdown.appendChild(option);
                });
            }
        }

        function updateMap() {
            const college = document.getElementById("college").value;
            if (college) {
                const [lat, lng] = college.split(",");
                const map = document.getElementById("map");
                map.src = `https://maps.google.com/maps?q=${lat},${lng}&z=15&output=embed`;
            }
        }
        function updateMapFromLatLng() {
            const latitude = document.getElementById("latitude").value;
            const longitude = document.getElementById("longitude").value;

            if (latitude && longitude) {
                const map = document.getElementById("map");
                map.src = `https://maps.google.com/maps?q=${latitude},${longitude}&z=15&output=embed`;
            } else {
                alert("Please enter both latitude and longitude to preview the map.");
            }
        }

        function toggleInputFields() {
            const inputMethod = document.getElementById("input-method").value;
            const latLngFields = document.getElementById("lat-lng-fields");
            const cityCollegeFields = document.getElementById("city-college-fields");

            if (inputMethod === "lat-lng") {
                latLngFields.style.display = "block";
                cityCollegeFields.style.display = "none";
            } else if (inputMethod === "city-college") {
                latLngFields.style.display = "none";
                cityCollegeFields.style.display = "block";
            } else {
                latLngFields.style.display = "none";
                cityCollegeFields.style.display = "none";
            }
        }

        document.getElementById('location-form').onsubmit = async (e) => {
            e.preventDefault();

            const inputMethod = document.getElementById("input-method").value;
            let latitude, longitude;

            if (inputMethod === "lat-lng") {
                latitude = document.getElementById("latitude").value;
                longitude = document.getElementById("longitude").value;
            } else if (inputMethod === "city-college") {
                const college = document.getElementById("college").value;
                if (!college) {
                    alert("Please select a college.");
                    return;
                }
                [latitude, longitude] = college.split(",");
            }

            const preference1 = document.getElementById('preference1').value;
            const preference2 = document.getElementById('preference2').value;
            const display_metro = document.getElementById('display-metro').value; // Get the value of the hidden input

            if (!latitude || !longitude) {
                alert("Please provide valid latitude and longitude.");
                return;
            }

            try {
                const response = await fetch('/search', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
                    body: new URLSearchParams({
                        latitude: latitude,
                        longitude: longitude,
                        preference1: preference1,
                        preference2: preference2,
                        display_metro: display_metro, // Include display_metro
                    }),
                });

                if (response.ok) {
                    const result = await response.json();
                    if (result.status === 'success') {
                        document.getElementById('map').src = `/map`;
                        alert('Map generated successfully');
                    } else {
                        alert(result.message || 'Error generating map');
                    }
                } else {
                    alert('Error: Could not fetch data');
                }
            } catch (error) {
                alert('Error: Something went wrong');
                console.error(error);
            }
        };




        // When 'Yes' button is clicked
        document.getElementById("metro-yes").addEventListener("click", function () {
            const metroValue = this.getAttribute("data-value"); // Get the 'data-value' of the clicked button

            document.getElementById("display-metro").value = metroValue; // Update hidden input value
            this.classList.add("active"); // Highlight the selected button
            document.getElementById("metro-no").classList.remove("active"); // Remove highlight from the other button
        });

        // When 'No' button is clicked
        document.getElementById("metro-no").addEventListener("click", function () {
            const metroValue = this.getAttribute("data-value"); // Get the 'data-value' of the clicked button

            document.getElementById("display-metro").value = metroValue; // Update hidden input value
            this.classList.add("active"); // Highlight the selected button
            document.getElementById("metro-yes").classList.remove("active"); // Remove highlight from the other button
        });










    </script>
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"
        integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.12.9/dist/umd/popper.min.js"
        integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/js/bootstrap.min.js"
        integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
        crossorigin="anonymous"></script>
</body>

</html>